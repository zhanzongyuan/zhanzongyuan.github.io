{"summary":"<h2 id=\"1-Cookie\"><a href=\"#1-Cookie\" class=\"headerlink\" title=\"1. Cookie\"></a>1. Cookie</h2><p><strong>&#x6982;&#x5FF5;&#xFF1A;</strong>  &#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x7EF4;&#x6301;&#x72B6;&#x6001;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</p>\n<ul>\n<li>HTTP&#x65E0;&#x72B6;&#x6001;&#xFF1A;&#x6307;&#x7684;&#x662F;&#x6BCF;&#x6B21;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;HTTP&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x800C;&#x8A00;&#x90FD;&#x662F;&#x4E00;&#x6B21;&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4E4B;&#x524D;&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x5BF9;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x6709;&#x4EFB;&#x4F55;&#x5F71;&#x54CD;&#x3002;&#x90FD;&#x662F;&#x628A;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x3002;</li>\n</ul>\n<blockquote>\n<p>&#x6253;&#x4E2A;&#x6BD4;&#x65B9;&#xFF1A;</p>\n<p>&#x65E0;&#x72B6;&#x6001;&#xFF1A;&#x6BCF;&#x6B21;&#x53BB;&#x540C;&#x4E00;&#x5BB6;&#x9910;&#x5385;&#x5403;&#x996D;&#xFF0C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E97;&#x5458;&#x90FD;&#x628A;&#x4F60;&#x5F53;&#x4F5C;&#x65B0;&#x5BA2;&#x4EBA;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x91CD;&#x65B0;&#x63A8;&#x8350;&#x83DC;&#x54C1;</p>\n<p>&#x6709;&#x72B6;&#x6001;&#xFF1A;&#x6BCF;&#x6B21;&#x53BB;&#x540C;&#x4E00;&#x5BB6;&#x9910;&#x5385;&#x5403;&#x996D;&#xFF0C;&#x6709;&#x72B6;&#x6001;&#x7684;&#x5E97;&#x5458;&#x5BF9;&#x4F60;&#x4E4B;&#x524D;&#x6765;&#x8FC7;&#x6709;&#x5370;&#x8C61;&#xFF0C;&#x5C31;&#x5F53;&#x4F5C;&#x8001;&#x987E;&#x5BA2;&#xFF0C;&#x80FD;&#x719F;&#x7EDC;&#x7684;&#x53EB;&#x51FA;&#x4F60;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x751A;&#x81F3;&#x90FD;&#x77E5;&#x9053;&#x4F60;&#x559C;&#x6B22;&#x7684;&#x54EA;&#x51E0;&#x9053;&#x83DC;</p>\n</blockquote>\n<p><strong>&#x76EE;&#x7684;&#xFF1A;</strong>Cookie&#x7684;&#x51FA;&#x73B0;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x4FDD;&#x7559;&#x4F60;&#x7684;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x90FD;&#x91CD;&#x590D;&#x767B;&#x5F55;</p>\n<p><strong>&#x7279;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>&#x72B6;&#x6001;&#xFF08;&#x5386;&#x53F2;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#xFF0C;Cookie&#xFF09;&#x6570;&#x636E;&#x4FDD;&#x7559;&#x5728;&#x5BA2;&#x6237;&#x7AEF;</li>\n<li>&#x5206;&#x4E3A;&#x4F1A;&#x8BDD;Cookie&#x548C;&#x6301;&#x4E45;Cookie</li>\n</ul>\n<p><strong>&#x673A;&#x5236;&#xFF1A;</strong></p>\n<p><img src=\"/2018/05/01/Session&#x548C;Cookie/Cookie.png\" alt=\"Cookie\"></p>\n<h2 id=\"2-Session\"><a href=\"#2-Session\" class=\"headerlink\" title=\"2. Session\"></a>2. Session</h2><blockquote>\n<p>Session&#x540C;&#x6837;&#x662F;&#x89E3;&#x51B3;HTTP&#x65E0;&#x72B6;&#x6001;&#x95EE;&#x9898;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x53EA;&#x662F;&#x5C06;&#x5386;&#x53F2;&#x6570;&#x636E;&#x4FDD;&#x7559;&#x5728;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x7531;&#x670D;&#x52A1;&#x5668;&#x6765;&#x7BA1;&#x7406;</p>\n</blockquote>\n<p><strong>&#x6982;&#x5FF5;&#xFF1A;</strong> &#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x7EF4;&#x6301;&#x72B6;&#x6001;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x6307;&#x8FD9;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#xFF08;&#x4E0E;Cookie&#x4E0D;&#x540C;&#x5728;&#x4E8E;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x7BA1;&#x7406;&#x7684;&#x4F4D;&#x7F6E;&#x4E0D;&#x540C;&#xFF0C;&#x4E00;&#x4E2A;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x4E00;&#x4E2A;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;</p>\n<p><strong>&#x7279;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>SessionId&#x662F;&#x5168;&#x5C40;&#x7684;&#x3001;&#x552F;&#x4E00;&#x7684;</li>\n<li>&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;SessionId</li>\n<li>Session&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x5668;&#x5B58;&#x50A8;&#xFF0C;&#x7BA1;&#x7406;</li>\n<li>Session&#x662F;&#x6709;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#xFF0C;&#x4F1A;&#x88AB;&#x4EA7;&#x751F;&#xFF0C;&#x6467;&#x6BC1;</li>\n</ul>\n<p><strong>&#x673A;&#x5236;&#xFF1A;</strong></p>\n<p><img src=\"/2018/05/01/Session&#x548C;Cookie/Session.png\" alt=\"Session\"></p>\n<blockquote>\n<p>References : <a href=\"https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md\" target=\"_blank\" rel=\"noopener\">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md</a></p>\n</blockquote>\n<h2 id=\"3-Express-js&#x914D;&#x7F6E;Redis&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;Session&#x4F1A;&#x8BDD;\"><a href=\"#3-Express-js&#x914D;&#x7F6E;Redis&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;Session&#x4F1A;&#x8BDD;\" class=\"headerlink\" title=\"3. Express.js&#x914D;&#x7F6E;Redis&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;Session&#x4F1A;&#x8BDD;\"></a>3. Express.js&#x914D;&#x7F6E;Redis&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;Session&#x4F1A;&#x8BDD;</h2><blockquote>\n<p>References:</p>\n<p><a href=\"http://www.cnblogs.com/chyingp/p/express-session.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/chyingp/p/express-session.html</a></p>\n<p><a href=\"https://segmentfault.com/a/1190000002630691\" target=\"_blank\" rel=\"noopener\">https://segmentfault.com/a/1190000002630691</a></p>\n<p><a href=\"http://www.runoob.com/redis/redis-commands.html\" target=\"_blank\" rel=\"noopener\">http://www.runoob.com/redis/redis-commands.html</a></p>\n</blockquote>\n<p>Redis&#x4F7F;&#x7528;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-server <span class=\"comment\"># &#x542F;&#x52A8;Redis&#x670D;&#x52A1;&#x5668;</span></span><br><span class=\"line\">redis-cli -h host -p port -a password <span class=\"comment\"># &#x8FDE;&#x63A5;&#x672C;&#x5730;redis&#x670D;&#x52A1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">config <span class=\"built_in\">set</span> requirepass password <span class=\"comment\"># &#x8BBE;&#x7F6E;&#x767B;&#x5F55;&#x5BC6;&#x7801;</span></span><br></pre></td></tr></table></figure>\n<p>Express.js&#x914D;&#x7F6E;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> expressSession = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;express-session&apos;</span>);  <span class=\"comment\">// &#x8BE5;&#x4E2D;&#x95F4;&#x4EF6;&#x4F7F;&#x5F97;req&#x6709;session&#x5C5E;&#x6027;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> RedisStore = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;connect-redis&apos;</span>)(expressSession);</span><br><span class=\"line\"><span class=\"keyword\">var</span> redisConfig={</span><br><span class=\"line\">    <span class=\"string\">&apos;cookie&apos;</span> : {</span><br><span class=\"line\">       <span class=\"string\">&apos;maxAge&apos;</span> : <span class=\"number\">1800000</span> <span class=\"comment\">// 30 * 60 * 1000 ms = 30 mins</span></span><br><span class=\"line\">    },</span><br><span class=\"line\">    <span class=\"string\">&apos;sessionStore&apos;</span> : {</span><br><span class=\"line\">        <span class=\"string\">&apos;host&apos;</span> : <span class=\"string\">&apos;127.0.0.1&apos;</span>,</span><br><span class=\"line\">        <span class=\"string\">&apos;port&apos;</span> : <span class=\"string\">&apos;6379&apos;</span>,</span><br><span class=\"line\">        <span class=\"string\">&apos;pass&apos;</span> : <span class=\"string\">&apos;password&apos;</span>,</span><br><span class=\"line\">        <span class=\"string\">&apos;db&apos;</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"string\">&apos;ttl&apos;</span> : <span class=\"number\">1800</span>, <span class=\"comment\">// 30 * 60 sec = 30 mins</span></span><br><span class=\"line\">        <span class=\"string\">&apos;logErrors&apos;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// var FileStore = require(&apos;session-file-store&apos;)(session);</span></span><br><span class=\"line\">app.use(expressSession({</span><br><span class=\"line\">    name : <span class=\"string\">&apos;sid&apos;</span>,</span><br><span class=\"line\">    secret : <span class=\"string\">&apos;zhidan&apos;</span>,  <span class=\"comment\">// &#x7528;&#x6765;&#x5BF9;session id&#x76F8;&#x5173;&#x7684;cookie&#x8FDB;&#x884C;&#x7B7E;&#x540D;</span></span><br><span class=\"line\">    resave : <span class=\"literal\">true</span>,</span><br><span class=\"line\">    rolling: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    saveUninitialized : <span class=\"literal\">false</span>,  <span class=\"comment\">// &#x662F;&#x5426;&#x81EA;&#x52A8;&#x4FDD;&#x5B58;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4F1A;&#x8BDD;&#xFF0C;&#x5EFA;&#x8BAE;false</span></span><br><span class=\"line\">    cookie : redisConfig.cookie,  <span class=\"comment\">// &#x662F;&#x5426;&#x6BCF;&#x6B21;&#x90FD;&#x91CD;&#x65B0;&#x4FDD;&#x5B58;&#x4F1A;&#x8BDD;&#xFF0C;&#x5EFA;&#x8BAE;false</span></span><br><span class=\"line\">    store : <span class=\"keyword\">new</span> RedisStore(redisConfig.sessionStore)  <span class=\"comment\">// Redis&#x5B58;&#x50A8;session&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5176;&#x4ED6;store&#xFF0C;&#x6BD4;&#x5982;FileStore()&#xFF0C;&#x672C;&#x5730;&#x6587;&#x672C;&#x5B58;&#x53D6;&#xFF0C;&#xFF09;</span></span><br><span class=\"line\">}));</span><br></pre></td></tr></table></figure>\n<p>Session&#x4F7F;&#x7528;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// &#x8BBE;&#x7F6E;Session</span></span><br><span class=\"line\">req.session.site = {<span class=\"attr\">number</span>: <span class=\"string\">&apos;110&apos;</span>};</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// &#x8BFB;&#x53D6;Session</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> number = req.session.number;</span><br></pre></td></tr></table></figure>\n"}